<!DOCTYPE html>
<html class="scroll-smooth" lang="pt-BR">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Cartão de Adepto Oficial do Real Madrid
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&amp;family=Roboto+Slab&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #e0e7ff 0%, #f0f4f9 100%);
  }
  ::-webkit-scrollbar {
    width: 8px;
  }
  ::-webkit-scrollbar-track {
    background: #f0f4f9;
  }
  ::-webkit-scrollbar-thumb {
    background-color: #3b82f6;
    border-radius: 10px;
    border: 2px solid #f0f4f9;
  }
  input:focus, select:focus, button:focus {
    outline-offset: 2px;
  }
  </style>
 </head>
 <body class="min-h-screen flex flex-col justify-center items-center p-4 sm:p-6 bg-gradient-to-br from-indigo-50 to-white">
  <main class="w-full max-w-lg bg-white rounded-3xl shadow-2xl p-8 sm:p-10 border border-indigo-200">
   <header class="mb-8 text-center relative">
    <img alt="Emblema oficial do Real Madrid em fundo branco, símbolo circular com coroa dourada e letras RM entrelaçadas" class="mx-auto w-20 h-20 mb-4 animate-pulse" src="https://upload.wikimedia.org/wikipedia/en/5/56/Real_Madrid_CF.svg"/>
    <h1 class="text-3xl sm:text-4xl font-extrabold text-indigo-900 drop-shadow-md tracking-wide">
     Cartão de Adepto Oficial do Real Madrid
    </h1>
    <p class="mt-2 text-indigo-600 font-semibold italic select-none">
     Hala Madrid y nada más
    </p>
    <div aria-hidden="true" class="absolute inset-0 flex justify-center items-center pointer-events-none">
     <img alt="Marca d'água do escudo do Real Madrid em azul claro translúcido, grande e centralizada atrás do cabeçalho" class="opacity-10 max-w-xs sm:max-w-md" height="300" src="https://storage.googleapis.com/a1aa/image/2137e610-e235-4b36-41dc-7ece60960e8f.jpg" width="300"/>
    </div>
   </header>
   <form aria-label="Formulário para gerar cartão de adepto oficial do Real Madrid" autocomplete="off" class="space-y-6" id="card-form" novalidate="">
    <div>
     <label class="block text-indigo-800 font-semibold mb-1 flex items-center gap-2" for="nome">
      <i class="fas fa-user text-indigo-600">
      </i>
      Nome completo
     </label>
     <input aria-describedby="nomeHelp" autocomplete="name" class="w-full rounded-xl border border-indigo-300 px-4 py-3 text-indigo-900 placeholder-indigo-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-600 transition" id="nome" name="nome" placeholder="Ex: Cristiano Ronaldo" required="" type="text"/>
     <p class="text-xs text-indigo-400 mt-1 select-none" id="nomeHelp">
      Digite seu nome completo conforme documento.
     </p>
    </div>
    <div>
     <label class="block text-indigo-800 font-semibold mb-1 flex items-center gap-2" for="numero">
      <i class="fas fa-id-card text-indigo-600">
      </i>
      Número do adepto
     </label>
     <input aria-describedby="numeroHelp" class="w-full rounded-xl border border-indigo-300 px-4 py-3 text-indigo-900 placeholder-indigo-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-600 transition" id="numero" name="numero" pattern="^[a-zA-Z0-9\-]+$" placeholder="Ex: RM123456" required="" type="text"/>
     <p class="text-xs text-indigo-400 mt-1 select-none" id="numeroHelp">
      Número único do seu cartão de adepto.
     </p>
    </div>
    <div>
     <label class="block text-indigo-800 font-semibold mb-1 flex items-center gap-2" for="morada">
      <i class="fas fa-map-marker-alt text-indigo-600">
      </i>
      Morada
     </label>
     <input aria-describedby="moradaHelp" class="w-full rounded-xl border border-indigo-300 px-4 py-3 text-indigo-900 placeholder-indigo-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-600 transition" id="morada" name="morada" placeholder="Ex: Rua das Flores, 123, Lisboa" required="" type="text"/>
     <p class="text-xs text-indigo-400 mt-1 select-none" id="moradaHelp">
      Informe seu endereço completo.
     </p>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
     <div>
      <label class="block text-indigo-800 font-semibold mb-1 flex items-center gap-2" for="pais">
       <i class="fas fa-flag-usa text-indigo-600">
       </i>
       País
      </label>
      <select aria-describedby="paisHelp" class="w-full rounded-xl border border-indigo-300 px-4 py-3 text-indigo-900 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-600 transition" id="pais" name="pais" required="">
       <option disabled="" value="">
        Selecione o país
       </option>
       <option selected="" value="Moçambique">
        Moçambique
       </option>
       <option value="Afeganistão">
        Afeganistão
       </option>
       <option value="África do Sul">
        África do Sul
       </option>
       <option value="Albânia">
        Albânia
       </option>
       <option value="Alemanha">
        Alemanha
       </option>
       <option value="Andorra">
        Andorra
       </option>
       <option value="Angola">
        Angola
       </option>
       <option value="Antígua e Barbuda">
        Antígua e Barbuda
       </option>
       <option value="Arábia Saudita">
        Arábia Saudita
       </option>
       <option value="Argentina">
        Argentina
       </option>
       <option value="Armênia">
        Armênia
       </option>
       <option value="Austrália">
        Austrália
       </option>
       <option value="Áustria">
        Áustria
       </option>
       <option value="Azerbaijão">
        Azerbaijão
       </option>
       <option value="Bahamas">
        Bahamas
       </option>
       <option value="Bahrein">
        Bahrein
       </option>
       <option value="Bangladesh">
        Bangladesh
       </option>
       <option value="Barbados">
        Barbados
       </option>
       <option value="Belarus">
        Belarus
       </option>
       <option value="Bélgica">
        Bélgica
       </option>
       <option value="Belize">
        Belize
       </option>
       <option value="Benin">
        Benin
       </option>
       <option value="Butão">
        Butão
       </option>
       <option value="Bolívia">
        Bolívia
       </option>
       <option value="Bósnia e Herzegovina">
        Bósnia e Herzegovina
       </option>
       <option value="Botsuana">
        Botsuana
       </option>
       <option value="Brasil">
        Brasil
       </option>
       <option value="Brunei">
        Brunei
       </option>
       <option value="Bulgária">
        Bulgária
       </option>
       <option value="Burkina Faso">
        Burkina Faso
       </option>
       <option value="Burundi">
        Burundi
       </option>
       <option value="Cabo Verde">
        Cabo Verde
       </option>
       <option value="Camarões">
        Camarões
       </option>
       <option value="Camboja">
        Camboja
       </option>
       <option value="Canadá">
        Canadá
       </option>
       <option value="Catar">
        Catar
       </option>
       <option value="Cazaquistão">
        Cazaquistão
       </option>
       <option value="Chade">
        Chade
       </option>
       <option value="Chile">
        Chile
       </option>
       <option value="China">
        China
       </option>
       <option value="Chipre">
        Chipre
       </option>
       <option value="Colômbia">
        Colômbia
       </option>
       <option value="Comores">
        Comores
       </option>
       <option value="Coreia do Norte">
        Coreia do Norte
       </option>
       <option value="Coreia do Sul">
        Coreia do Sul
       </option>
       <option value="Costa do Marfim">
        Costa do Marfim
       </option>
       <option value="Costa Rica">
        Costa Rica
       </option>
       <option value="Croácia">
        Croácia
       </option>
       <option value="Cuba">
        Cuba
       </option>
       <option value="Dinamarca">
        Dinamarca
       </option>
       <option value="Djibuti">
        Djibuti
       </option>
       <option value="Dominica">
        Dominica
       </option>
       <option value="Egito">
        Egito
       </option>
       <option value="El Salvador">
        El Salvador
       </option>
       <option value="Emirados Árabes Unidos">
        Emirados Árabes Unidos
       </option>
       <option value="Equador">
        Equador
       </option>
       <option value="Eritreia">
        Eritreia
       </option>
       <option value="Eslováquia">
        Eslováquia
       </option>
       <option value="Eslovênia">
        Eslovênia
       </option>
       <option value="Espanha">
        Espanha
       </option>
       <option value="Estados Unidos">
        Estados Unidos
       </option>
       <option value="Estônia">
        Estônia
       </option>
       <option value="Eswatini">
        Eswatini
       </option>
       <option value="Etiópia">
        Etiópia
       </option>
       <option value="Fiji">
        Fiji
       </option>
       <option value="Filipinas">
        Filipinas
       </option>
       <option value="Finlândia">
        Finlândia
       </option>
       <option value="França">
        França
       </option>
       <option value="Gabão">
        Gabão
       </option>
       <option value="Gâmbia">
        Gâmbia
       </option>
       <option value="Gana">
        Gana
       </option>
       <option value="Geórgia">
        Geórgia
       </option>
       <option value="Granada">
        Granada
       </option>
       <option value="Grécia">
        Grécia
       </option>
       <option value="Guatemala">
        Guatemala
       </option>
       <option value="Guiana">
        Guiana
       </option>
       <option value="Guiné">
        Guiné
       </option>
       <option value="Guiné-Bissau">
        Guiné-Bissau
       </option>
       <option value="Guiné Equatorial">
        Guiné Equatorial
       </option>
       <option value="Haiti">
        Haiti
       </option>
       <option value="Honduras">
        Honduras
       </option>
       <option value="Hungria">
        Hungria
       </option>
       <option value="Iêmen">
        Iêmen
       </option>
       <option value="Ilhas Marshall">
        Ilhas Marshall
       </option>
       <option value="Índia">
        Índia
       </option>
       <option value="Indonésia">
        Indonésia
       </option>
       <option value="Irã">
        Irã
       </option>
       <option value="Iraque">
        Iraque
       </option>
       <option value="Irlanda">
        Irlanda
       </option>
       <option value="Islândia">
        Islândia
       </option>
       <option value="Israel">
        Israel
       </option>
       <option value="Itália">
        Itália
       </option>
       <option value="Jamaica">
        Jamaica
       </option>
       <option value="Japão">
        Japão
       </option>
       <option value="Jordânia">
        Jordânia
       </option>
       <option value="Kiribati">
        Kiribati
       </option>
       <option value="Kuwait">
        Kuwait
       </option>
       <option value="Laos">
        Laos
       </option>
       <option value="Lesoto">
        Lesoto
       </option>
       <option value="Letônia">
        Letônia
       </option>
       <option value="Líbano">
        Líbano
       </option>
       <option value="Libéria">
        Libéria
       </option>
       <option value="Líbia">
        Líbia
       </option>
       <option value="Liechtenstein">
        Liechtenstein
       </option>
       <option value="Lituânia">
        Lituânia
       </option>
       <option value="Luxemburgo">
        Luxemburgo
       </option>
       <option value="Madagáscar">
        Madagáscar
       </option>
       <option value="Malásia">
        Malásia
       </option>
       <option value="Malaui">
        Malaui
       </option>
       <option value="Maldivas">
        Maldivas
       </option>
       <option value="Mali">
        Mali
       </option>
       <option value="Malta">
        Malta
       </option>
       <option value="Marrocos">
        Marrocos
       </option>
       <option value="Maurício">
        Maurício
       </option>
       <option value="Mauritânia">
        Mauritânia
       </option>
       <option value="México">
        México
       </option>
       <option value="Micronésia">
        Micronésia
       </option>
       <option value="Moçambique">
        Moçambique
       </option>
       <option value="Moldávia">
        Moldávia
       </option>
       <option value="Mônaco">
        Mônaco
       </option>
       <option value="Mongólia">
        Mongólia
       </option>
       <option value="Montenegro">
        Montenegro
       </option>
       <option value="Myanmar">
        Myanmar
       </option>
       <option value="Namíbia">
        Namíbia
       </option>
       <option value="Nauru">
        Nauru
       </option>
       <option value="Nepal">
        Nepal
       </option>
       <option value="Nicarágua">
        Nicarágua
       </option>
       <option value="Níger">
        Níger
       </option>
       <option value="Nigéria">
        Nigéria
       </option>
       <option value="Noruega">
        Noruega
       </option>
       <option value="Nova Zelândia">
        Nova Zelândia
       </option>
       <option value="Omã">
        Omã
       </option>
       <option value="Países Baixos">
        Países Baixos
       </option>
       <option value="Palau">
        Palau
       </option>
       <option value="Panamá">
        Panamá
       </option>
       <option value="Papua-Nova Guiné">
        Papua-Nova Guiné
       </option>
       <option value="Paquistão">
        Paquistão
       </option>
       <option value="Paraguai">
        Paraguai
       </option>
       <option value="Peru">
        Peru
       </option>
       <option value="Polônia">
        Polônia
       </option>
       <option value="Portugal">
        Portugal
       </option>
       <option value="Quênia">
        Quênia
       </option>
       <option value="Quirguistão">
        Quirguistão
       </option>
       <option value="Reino Unido">
        Reino Unido
       </option>
       <option value="República Centro-Africana">
        República Centro-Africana
       </option>
       <option value="República Democrática do Congo">
        República Democrática do Congo
       </option>
       <option value="República Dominicana">
        República Dominicana
       </option>
       <option value="República Tcheca">
        República Tcheca
       </option>
       <option value="Romênia">
        Romênia
       </option>
       <option value="Ruanda">
        Ruanda
       </option>
       <option value="Rússia">
        Rússia
       </option>
       <option value="Salvador">
        Salvador
       </option>
       <option value="Samoa">
        Samoa
       </option>
       <option value="San Marino">
        San Marino
       </option>
       <option value="Santa Lúcia">
        Santa Lúcia
       </option>
       <option value="São Cristóvão e Nevis">
        São Cristóvão e Nevis
       </option>
       <option value="São Tomé e Príncipe">
        São Tomé e Príncipe
       </option>
       <option value="São Vicente e Granadinas">
        São Vicente e Granadinas
       </option>
       <option value="Senegal">
        Senegal
       </option>
       <option value="Serra Leoa">
        Serra Leoa
       </option>
       <option value="Sérvia">
        Sérvia
       </option>
       <option value="Singapura">
        Singapura
       </option>
       <option value="Síria">
        Síria
       </option>
       <option value="Somália">
        Somália
       </option>
       <option value="Sri Lanka">
        Sri Lanka
       </option>
       <option value="Suazilândia">
        Suazilândia
       </option>
       <option value="Sudão">
        Sudão
       </option>
       <option value="Sudão do Sul">
        Sudão do Sul
       </option>
       <option value="Suécia">
        Suécia
       </option>
       <option value="Suíça">
        Suíça
       </option>
       <option value="Suriname">
        Suriname
       </option>
       <option value="Tailândia">
        Tailândia
       </option>
       <option value="Taiwan">
        Taiwan
       </option>
       <option value="Tajiquistão">
        Tajiquistão
       </option>
       <option value="Tanzânia">
        Tanzânia
       </option>
       <option value="Timor-Leste">
        Timor-Leste
       </option>
       <option value="Togo">
        Togo
       </option>
       <option value="Tonga">
        Tonga
       </option>
       <option value="Trinidad e Tobago">
        Trinidad e Tobago
       </option>
       <option value="Tunísia">
        Tunísia
       </option>
       <option value="Turcomenistão">
        Turcomenistão
       </option>
       <option value="Turquia">
        Turquia
       </option>
       <option value="Tuvalu">
        Tuvalu
       </option>
       <option value="Ucrânia">
        Ucrânia
       </option>
       <option value="Uganda">
        Uganda
       </option>
       <option value="Uruguai">
        Uruguai
       </option>
       <option value="Uzbequistão">
        Uzbequistão
       </option>
       <option value="Vanuatu">
        Vanuatu
       </option>
       <option value="Vaticano">
        Vaticano
       </option>
       <option value="Venezuela">
        Venezuela
       </option>
       <option value="Vietnã">
        Vietnã
       </option>
       <option value="Zâmbia">
        Zâmbia
       </option>
       <option value="Zimbábue">
        Zimbábue
       </option>
      </select>
      <p class="text-xs text-indigo-400 mt-1 select-none" id="paisHelp">
       Selecione seu país de residência. Você pode digitar para pesquisar.
      </p>
     </div>
     <div>
      <label class="block text-indigo-800 font-semibold mb-1 flex items-center gap-2" for="nacionalidade">
       <i class="fas fa-globe-americas text-indigo-600">
       </i>
       Nacionalidade
      </label>
      <input aria-describedby="nacionalidadeHelp" class="w-full rounded-xl border border-indigo-300 px-4 py-3 text-indigo-900 placeholder-indigo-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-600 transition" id="nacionalidade" name="nacionalidade" placeholder="Ex: Moçambicana" required="" type="text"/>
      <p class="text-xs text-indigo-400 mt-1 select-none" id="nacionalidadeHelp">
       Informe sua nacionalidade.
      </p>
     </div>
    </div>
    <div>
     <label class="block text-indigo-800 font-semibold mb-1 flex items-center gap-2" for="foto">
      <i class="fas fa-camera-retro text-indigo-600">
      </i>
      Upload de foto
     </label>
     <input accept="image/*" aria-describedby="fotoHelp" class="w-full rounded-xl border border-indigo-300 px-4 py-2 text-indigo-900 placeholder-indigo-400 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-600 transition cursor-pointer" id="foto" name="foto" required="" type="file"/>
     <p class="text-xs text-indigo-400 mt-1 select-none" id="fotoHelp">
      Envie uma foto nítida, preferencialmente com fundo claro. A foto será ajustada para caber perfeitamente no cartão.
     </p>
    </div>
    <button class="w-full bg-indigo-700 hover:bg-indigo-900 text-white font-extrabold py-3 rounded-3xl shadow-lg transition flex justify-center items-center gap-3 focus:ring-4 focus:ring-indigo-400 focus:outline-none" id="gerar-btn" type="submit">
     <i class="fas fa-id-card-alt text-lg animate-pulse">
     </i>
     Gerar Cartão
    </button>
   </form>
   <section aria-atomic="true" aria-live="polite" aria-relevant="additions" class="mt-10 text-center" id="card-container">
    <canvas class="mx-auto rounded-3xl shadow-2xl hidden" height="350" id="card-canvas" width="600">
    </canvas>
    <button class="mt-6 bg-emerald-600 hover:bg-emerald-800 text-white font-bold py-3 px-8 rounded-3xl shadow-lg transition hidden focus:ring-4 focus:ring-emerald-400 focus:outline-none flex items-center justify-center gap-3" id="download-btn">
     <i class="fas fa-download animate-bounce">
     </i>
     Baixar Cartão (PNG)
    </button>
   </section>
  </main>
  <footer class="mt-12 mb-6 text-center text-indigo-600 font-semibold select-none">
   Desenvolvido por
   <a class="underline hover:text-indigo-900 transition" href="https://github.com/sahilaktar" rel="noopener noreferrer" target="_blank">
    Sahil Aktar
   </a>
  </footer>
  <script>
   // Polyfill for datalist search on select (basic)
  // We'll enhance the country select with a datalist for searchability
  // But since <select> doesn't support search natively, we replace with input + datalist

  // Replace the country select with an input + datalist for search and default value
  const paisSelect = document.getElementById('pais');
  const paisOptions = Array.from(paisSelect.options).map(o => ({value: o.value, text: o.text}));
  const paisParent = paisSelect.parentElement;

  // Create input and datalist
  const inputPais = document.createElement('input');
  inputPais.setAttribute('list', 'paises-list');
  inputPais.setAttribute('name', 'pais');
  inputPais.setAttribute('id', 'pais');
  inputPais.setAttribute('required', '');
  inputPais.setAttribute('aria-describedby', 'paisHelp');
  inputPais.setAttribute('placeholder', 'Selecione ou digite seu país');
  inputPais.className = paisSelect.className;
  inputPais.value = 'Moçambique';

  const datalist = document.createElement('datalist');
  datalist.id = 'paises-list';

  paisOptions.forEach(({value, text}) => {
    if(value !== "") {
      const option = document.createElement('option');
      option.value = text;
      datalist.appendChild(option);
    }
  });

  paisParent.replaceChild(inputPais, paisSelect);
  paisParent.appendChild(datalist);

  // Validate inputPais against datalist options on form submit
  const form = document.getElementById('card-form');
  const canvas = document.getElementById('card-canvas');
  const ctx = canvas.getContext('2d');
  const downloadBtn = document.getElementById('download-btn');

  const emblemURL = 'https://upload.wikimedia.org/wikipedia/en/5/56/Real_Madrid_CF.svg';
  const stadiumURL = 'https://placehold.co/600x350/png?text=Est%C3%A1dio+Santiago+Bernab%C3%A9u+Real+Madrid&font=Poppins&fontSize=28&bg=ffffff&fg=a0aec0';

  function roundRect(ctx, x, y, w, h, r) {
    if (w < 2 * r) r = w / 2;
    if (h < 2 * r) r = h / 2;
    ctx.beginPath();
    ctx.moveTo(x + r, y);
    ctx.arcTo(x + w, y, x + w, y + h, r);
    ctx.arcTo(x + w, y + h, x, y + h, r);
    ctx.arcTo(x, y + h, x, y, r);
    ctx.closePath();
  }

  function formatDateBR(dateStr) {
    const d = new Date(dateStr);
    if (isNaN(d)) return '';
    const day = String(d.getDate()).padStart(2, '0');
    const month = String(d.getMonth() + 1).padStart(2, '0');
    const year = d.getFullYear();
    return `${day}/${month}/${year}`;
  }

  function loadImage(src) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.onload = () => resolve(img);
      img.onerror = () => reject(new Error('Erro ao carregar imagem: ' + src));
      img.src = src;
    });
  }

  function readFileAsImage(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = () => reject(new Error('Erro ao carregar a imagem do arquivo.'));
        img.src = reader.result;
      };
      reader.onerror = () => reject(new Error('Erro ao ler o arquivo.'));
      reader.readAsDataURL(file);
    });
  }

  function drawWatermark(ctx, text, width, height) {
    ctx.save();
    ctx.font = 'bold 48px Poppins, sans-serif';
    ctx.fillStyle = 'rgba(0, 82, 204, 0.10)';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.translate(width / 2, height / 2);
    ctx.rotate(-Math.PI / 6);
    ctx.fillText(text, 0, 0);
    ctx.restore();
  }

  function drawLogoText(ctx, x, y) {
    ctx.save();
    ctx.fillStyle = '#003399';
    ctx.font = 'bold 28px Poppins, sans-serif';
    ctx.textAlign = 'right';
    ctx.textBaseline = 'top';
    ctx.fillText('REAL MADRID CF', x, y);
    ctx.restore();
  }

  async function drawCard({ nome, numero, morada, pais, nacionalidade, foto }) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const emblemImg = await loadImage(emblemURL);
    const stadiumImg = await loadImage(stadiumURL);

    // Background stadium image with subtle opacity
    ctx.save();
    ctx.globalAlpha = 0.10;
    ctx.drawImage(stadiumImg, 0, 0, canvas.width, canvas.height);
    ctx.restore();

    // Card background with gradient
    const bgGradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
    bgGradient.addColorStop(0, '#fefefe');
    bgGradient.addColorStop(1, '#e6ecf7');
    roundRect(ctx, 0, 0, canvas.width, canvas.height, 28);
    ctx.fillStyle = bgGradient;
    ctx.fill();

    // Border
    ctx.lineWidth = 4;
    ctx.strokeStyle = '#003399';
    roundRect(ctx, 2, 2, canvas.width - 4, canvas.height - 4, 28);
    ctx.stroke();

    // Watermark text (lema)
    drawWatermark(ctx, 'Hala Madrid y nada más', canvas.width, canvas.height);

    // Title top center with subtle shadow
    ctx.fillStyle = '#001f66';
    ctx.font = 'bold 24px Poppins, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';
    ctx.shadowColor = 'rgba(0,0,0,0.15)';
    ctx.shadowBlur = 4;
    ctx.fillText('MINISTÉRIO DOS ADEPTOS DO REAL MADRID', canvas.width / 2, 18);
    ctx.shadowBlur = 0;

    // Emblem top right corner (scaled and positioned)
    const emblemSize = 90;
    ctx.drawImage(emblemImg, canvas.width - emblemSize - 25, 20, emblemSize, emblemSize);

    // Draw logo text below emblem
    drawLogoText(ctx, canvas.width - 35, 115);

    // Photo box left side with shadow and border
    const photoX = 45;
    const photoY = 90;
    const photoW = 160;
    const photoH = 210;
    roundRect(ctx, photoX - 6, photoY - 6, photoW + 12, photoH + 12, 20);
    ctx.fillStyle = '#dbe6f7';
    ctx.shadowColor = 'rgba(0, 82, 204, 0.3)';
    ctx.shadowBlur = 12;
    ctx.fill();
    ctx.shadowBlur = 0;
    ctx.lineWidth = 3;
    ctx.strokeStyle = '#003399';
    roundRect(ctx, photoX - 6, photoY - 6, photoW + 12, photoH + 12, 20);
    ctx.stroke();

    // Draw user photo clipped with rounded corners
    ctx.save();
    roundRect(ctx, photoX, photoY, photoW, photoH, 16);
    ctx.clip();
    // Fit photo preserving aspect ratio and cover area
    let sx, sy, sw, sh;
    const arCanvas = photoW / photoH;
    const arImg = foto.width / foto.height;
    if (arImg > arCanvas) {
      sh = foto.height;
      sw = sh * arCanvas;
      sx = (foto.width - sw) / 2;
      sy = 0;
    } else {
      sw = foto.width;
      sh = sw / arCanvas;
      sx = 0;
      sy = (foto.height - sh) / 2;
    }
    ctx.drawImage(foto, sx, sy, sw, sh, photoX, photoY, photoW, photoH);
    ctx.restore();

    // Text info right side
    ctx.fillStyle = '#002366';
    ctx.font = 'bold 22px Poppins, sans-serif';
    ctx.textAlign = 'left';
    ctx.textBaseline = 'top';

    const textX = photoX + photoW + 50;
    let textY = photoY;

    // Nome
    ctx.fillText('Nome:', textX, textY);
    ctx.font = '18px Poppins, sans-serif';
    ctx.fillText(nome, textX, textY + 30);

    // Número do adepto
    textY += 70;
    ctx.font = 'bold 22px Poppins, sans-serif';
    ctx.fillText('Número do adepto:', textX, textY);
    ctx.font = '18px Poppins, sans-serif';
    ctx.fillText(numero, textX, textY + 30);

    // Morada
    textY += 70;
    ctx.font = 'bold 22px Poppins, sans-serif';
    ctx.fillText('Morada:', textX, textY);
    ctx.font = '18px Poppins, sans-serif';
    ctx.fillText(morada, textX, textY + 30);

    // País
    textY += 70;
    ctx.font = 'bold 22px Poppins, sans-serif';
    ctx.fillText('País:', textX, textY);
    ctx.font = '18px Poppins, sans-serif';
    ctx.fillText(pais, textX, textY + 30);

    // Nacionalidade
    textY += 70;
    ctx.font = 'bold 22px Poppins, sans-serif';
    ctx.fillText('Nacionalidade:', textX, textY);
    ctx.font = '18px Poppins, sans-serif';
    ctx.fillText(nacionalidade, textX, textY + 30);

    // Data de validade (vitalício)
    textY += 70;
    ctx.font = 'bold 22px Poppins, sans-serif';
    ctx.fillText('Validade:', textX, textY);
    ctx.font = '18px Poppins, sans-serif';
    ctx.fillText('Vitalício', textX, textY + 30);

    // Footer phrase bottom center with subtle shadow
    ctx.fillStyle = '#444a5a';
    ctx.font = 'italic 15px Roboto Slab, serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'bottom';
    ctx.shadowColor = 'rgba(0,0,0,0.1)';
    ctx.shadowBlur = 2;
    ctx.fillText('Este cartão é um simbólico que representa um vínculo oficial com o clube.', canvas.width / 2, canvas.height - 22);
    ctx.shadowBlur = 0;
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    if (!form.checkValidity()) {
      form.reportValidity();
      return;
    }

    const nome = form.nome.value.trim();
    const numero = form.numero.value.trim();
    const morada = form.morada.value.trim();
    const pais = form.pais.value.trim();
    const nacionalidade = form.nacionalidade.value.trim();
    const fotoFile = form.foto.files[0];

    if (!fotoFile) {
      alert('Por favor, envie uma foto.');
      return;
    }

    if (!fotoFile.type.startsWith('image/')) {
      alert('O arquivo enviado não é uma imagem válida.');
      return;
    }

    // Validate pais against datalist options
    const paisValid = Array.from(document.getElementById('paises-list').options).some(opt => opt.value.toLowerCase() === pais.toLowerCase());
    if (!paisValid) {
      alert('Por favor, selecione um país válido da lista.');
      return;
    }

    try {
      const fotoImg = await readFileAsImage(fotoFile);

      canvas.classList.remove('hidden');
      downloadBtn.classList.remove('hidden');

      await drawCard({ nome, numero, morada, pais, nacionalidade, foto: fotoImg });

      canvas.scrollIntoView({ behavior: 'smooth', block: 'center' });
    } catch (err) {
      alert('Erro ao processar a imagem: ' + err.message);
    }
  });

  downloadBtn.addEventListener('click', () => {
    const link = document.createElement('a');
    link.download = 'cartao_adepto_real_madrid.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  });
  </script>
 </body>
</html>
